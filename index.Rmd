---
title: "Visualisation of science-wide author databases of standardized citation indicators for Sri Lanka"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(readxl)
library(here)
library(plotly)
library(patchwork)
```

```{r}
# colours
color_ins <- c("University of Sri Jayewardenepura"="red",                     "International Water Management Institute (IWMI)" = "#1f78b4",             "University of Peradeniya" = "#a6cee3",       "Wayamba University of Sri Lanka"  = "#b2df8a",
"National Institute of Fundamental Studies, Sri Lanka" = "#33a02c","Rajarata University of Sri Lanka" = "#fb9a99",  "University of Jaffna"   = "#fdbf6f",                             "Munasinghe Institute for Development (MIND)" = "#ff7f00",          "University of Kelaniya"  = "#cab2d6",                               "University of Colombo" = "#6a3d9a")
```

```{r}
# data
career <- read_excel(here("data", "Table_1_Authors_career_2022_pubs_since_1788_wopp_extracted_202310.xlsx"), sheet=2)
career$inst_name <- recode_factor(career$inst_name,"International Water Management Institute" = "International Water Management Institute (IWMI)"  , 
                               "Faculty of Medicine, University of Peradeniya"= "University of Peradeniya", "University of Colombo Faculty of Medicine"=   "University of Colombo" ,"International Water Management Institute (IWMI) Colombo" = 
"International Water Management Institute (IWMI)") 
career_lka <- career |> filter(cntry=="lka")
singleyr <- read_excel(here("data", "Table_1_Authors_singleyr_2022_pubs_since_1788_wopp_extracted_202310.xlsx"), sheet=2)
singleyr$inst_name <- recode_factor(singleyr$inst_name, "International Water Management Institute" = "International Water Management Institute (IWMI)"  , 
                               "Faculty of Medicine, University of Peradeniya"= "University of Peradeniya", "University of Colombo Faculty of Medicine"=   "University of Colombo" ,"International Water Management Institute (IWMI) Colombo" = 
"International Water Management Institute (IWMI)")
singleyr_lka <- singleyr |> filter(cntry=="lka")
```

# USJ Highlights

Column {data-width=400}
-----------------------------------------------

### Figure 1: Single recent year data pertain to citations received during calendar year 2022

```{r}
singleyr_lka  |>
	group_by(inst_name) |>
	summarise(count = n()) |> 
	ggplot(aes(x = reorder(inst_name,(-count)), y = count, fill=I(ifelse(inst_name=="University of Sri Jayewardenepura", "red", "black")))) + 
		geom_bar(stat = 'identity') + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("")+xlab("Institution name") + ylab("Number of authors")
```


### Figure 2: Career-long data are updated to end-of-2022

```{r, fig.cap=""}
career_lka |>
	group_by(inst_name) |>
	summarise(count = n()) |> 
	ggplot(aes(x = reorder(inst_name,(-count)), y = count, fill=I(ifelse(inst_name=="University of Sri Jayewardenepura", "red", "black")))) + 
		geom_bar(stat = 'identity') + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Institution name") + ylab("Number of authors")
```





Column {data-width=300}
-----------------------------------------------------------------------

### Rank based on composite score single data (self-citation excluded)

```{r, fig.height=12}
singleyr_lka_filter <- singleyr_lka |>
  select(c("authfull", "inst_name", "rank"))
career_lka_filter <- career_lka |>
  select(c("authfull", "inst_name", "rank"))
p1 <- ggplot(data=singleyr_lka_filter,
       aes(y=reorder(authfull,(-rank)), x = rank, colour=I(ifelse(inst_name=="University of Sri Jayewardenepura", "red", "black")))) + geom_point() + geom_segment(aes(yend = reorder(authfull,(-rank))), xend = 0, colour = "grey50") + ylab("Author name") + xlab("Rank") + scale_x_continuous(labels = scales::comma_format()) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) 
p1.2 <- plotly::ggplotly(p1, tooltip = c("rank")) |> style(showlegend = FALSE)

p1.2



```

Column {data-width=300}
-----------------------------------------------------------------------

### Rank based on composite score career long data (self-citation excluded)

```{r, fig.height=12}
p2 <- ggplot(data=career_lka_filter,
       aes(y=reorder(authfull,(-rank)), x = rank, col=I(ifelse(inst_name=="University of Sri Jayewardenepura", "red", "black")))) + geom_point() +   geom_segment(aes(yend = reorder(authfull,(-rank))), xend = 0, colour = "grey50") +
  ylab("Author name") + xlab("Rank")  + scale_x_continuous(labels = scales::comma_format()) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
#p3 <- ggplot(career_lka_filter, aes(y=reorder(authfull,(-rank)), x = "1", fill = inst_name)) +
#  geom_tile() + theme(legend.position ="none",axis.text.y=element_blank(), 
#      axis.ticks.y=element_blank()) +ylab("")
p4 <- ggplotly(p2, tooltip = c("rank"))
p4 |> style(showlegend = FALSE)
```



# Authors by Institution - 2022 data

Column {data-width=300}
-----------------------------------------------------------------------

### Rank based on composite score: 2022 calender data (self-citation excluded)

```{r, fig.height=12}
a1 <- ggplot(data=singleyr_lka_filter,
       aes(y=reorder(authfull,(-rank)), x = rank, col=inst_name)) + geom_point() +   geom_segment(aes(yend = reorder(authfull,(-rank)), col = inst_name), xend = 0 ) +
  ylab("Author name") + xlab("Rank")  + scale_x_continuous(labels = scales::comma_format()) +
  scale_color_manual(values = color_ins) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

a2 <- ggplotly(a1, tooltip = c("rank", "inst_name"))
a2 |> style(showlegend = TRUE)
```



# Authors by Institution - Career long data

Column {data-width=300}
-----------------------------------------------------------------------

### Rank based on composite score career long data (self-citation excluded)

```{r, fig.height=12}
b1 <- ggplot(data=career_lka_filter,
       aes(y=reorder(authfull,(-rank)), x = rank, col=inst_name)) + geom_point() +   geom_segment(aes(yend = reorder(authfull,(-rank)),col = inst_name), xend = 0) +
  ylab("Author name") + xlab("Rank")  + scale_x_continuous(labels = scales::comma_format()) + scale_color_manual(values = color_ins) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

b2 <- ggplotly(b1, tooltip = c("rank", "inst_name"))
b2 |> style(showlegend = TRUE)
```








# Career-long data (updated to end-of-2022 )

```{r}
knitr::kable(career_lka)
```

# Single recent year data (2022)

```{r}
knitr::kable(singleyr_lka)
```





# Acknowledgement

Ioannidis, John P.A. (2023), “October 2023 data-update for "Updated science-wide author databases of standardized citation indicators"”, Elsevier Data Repository, V6, doi: 10.17632/btchxktzyw.6